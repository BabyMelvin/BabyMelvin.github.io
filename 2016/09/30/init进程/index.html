<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="1.概述init进程是Linux系统用户空间第一个进程，进程号为1.改进程功能分为4部分：  1.分析和运行所有init.rc文件. 2.生成设备驱动节点（通过rc文件创建） 3.处理子进程的终止(signal方式) 4.提供属性服务">
<meta name="keywords" content="Android进程">
<meta property="og:type" content="article">
<meta property="og:title" content="init进程">
<meta property="og:url" content="http://yoursite.com/2016/09/30/init进程/index.html">
<meta property="og:site_name" content="杭">
<meta property="og:description" content="1.概述init进程是Linux系统用户空间第一个进程，进程号为1.改进程功能分为4部分：  1.分析和运行所有init.rc文件. 2.生成设备驱动节点（通过rc文件创建） 3.处理子进程的终止(signal方式) 4.提供属性服务">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2016/09/30/init进程/init_oneshot.jpg">
<meta property="og:updated_time" content="2019-02-02T11:21:31.746Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="init进程">
<meta name="twitter:description" content="1.概述init进程是Linux系统用户空间第一个进程，进程号为1.改进程功能分为4部分：  1.分析和运行所有init.rc文件. 2.生成设备驱动节点（通过rc文件创建） 3.处理子进程的终止(signal方式) 4.提供属性服务">
<meta name="twitter:image" content="http://yoursite.com/2016/09/30/init进程/init_oneshot.jpg">



  <link rel="alternate" href="/atom.xml" title="杭" type="application/atom+xml">




  <link rel="canonical" href="http://yoursite.com/2016/09/30/init进程/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>init进程 | 杭</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">杭</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Practice makes perfect!</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/30/init进程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Melvin">
      <meta itemprop="description" content="Learn Android/Linux OS">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杭">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">init进程
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-30 04:10:38" itemprop="dateCreated datePublished" datetime="2016-09-30T04:10:38+08:00">2016-09-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-02-02 19:21:31" itemprop="dateModified" datetime="2019-02-02T19:21:31+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h1><p><code>init进程</code>是Linux系统用户空间第一个进程，进程号为1.改进程功能分为4部分：</p>
<ul>
<li>1.分析和运行所有<code>init.rc</code>文件.</li>
<li>2.生成设备驱动节点（通过rc文件创建）</li>
<li>3.处理子进程的终止(signal方式)</li>
<li>4.提供属性服务</li>
</ul>
<a id="more"></a>
<h2 id="1-1-main"><a href="#1-1-main" class="headerlink" title="1.1 main"></a>1.1 main</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//init.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span>**argv)</span></span>&#123;</span><br><span class="line">	...</span><br><span class="line">	umask(<span class="number">0</span>);<span class="comment">//设置文件属性0777</span></span><br><span class="line">	klog_init();<span class="comment">//初始化kernel log,位于设备节点/dev/kmsg</span></span><br><span class="line">	klog_set_level(KLOG_NOTICE_LEVEL);<span class="comment">//设置输出log级别</span></span><br><span class="line">	<span class="comment">//输出init启动阶段的Log</span></span><br><span class="line">	NOTICE(<span class="string">"init%s started\n"</span>,is_first_stage?<span class="string">""</span> : <span class="string">"second stage"</span>);</span><br><span class="line">	property_init();<span class="comment">//创建一块共享内存空间，用于属性服务</span></span><br><span class="line">	signal_handler_init();<span class="comment">//初始化子进程退出信号处理</span></span><br><span class="line">	property_load_boot_defaults();<span class="comment">//加载default.prop文件</span></span><br><span class="line">	start_property_service();<span class="comment">//启动属性服务器器(通过socket通信)</span></span><br><span class="line">	init_parse_config_file(<span class="string">"/init.rc"</span>);</span><br><span class="line">	<span class="comment">//执行rc文件中触发器on early_init 语句</span></span><br><span class="line">	action_for_each_trigger(<span class="string">"early-init"</span>,action_add_queue_tail);</span><br><span class="line">	<span class="comment">//等待设备初始化完成</span></span><br><span class="line">	queue_buildin_aciton(wait_for_coldboot_done_action,<span class="string">"wit_for_coldboot_done"</span>);</span><br><span class="line">	queue_builtin_action(mix_hwrng_into_linux_rng_action, <span class="string">"mix_hwrng_into_linux_rng"</span>);</span><br><span class="line">	<span class="comment">//设备组合键的初始化操作</span></span><br><span class="line">	queue_builtin_aciton(keychord_init_aciton,<span class="string">"keychord_init"</span>);</span><br><span class="line">	<span class="comment">//屏幕上像是Android静态logo</span></span><br><span class="line">	queue_builtin_action(console_init_action,<span class="string">"console_init"</span>);</span><br><span class="line">	<span class="comment">//执行rc文件触发器on init 语句</span></span><br><span class="line">	action_for_each_trigger(<span class="string">"init"</span>,action_add_queue_tail);</span><br><span class="line">	queue_builtin_action(mix_hwrng_into_linux_rng_action,<span class="string">"mix_hwrng_info_linux_rng_action"</span>);</span><br><span class="line">	<span class="keyword">char</span> bootmode[PROP_VALUE_MAX];</span><br><span class="line">	<span class="comment">//当处于充电模式，则charger加入执行队列；否则late-init加入队列。</span></span><br><span class="line">	<span class="keyword">if</span>(property_get(<span class="string">"ro.bootmode"</span>,bootmode)&gt;<span class="number">0</span>&amp;&amp;<span class="built_in">strcmp</span>(bootmode,<span class="string">"charger"</span>))&#123;</span><br><span class="line">		action_for_each_trigger(<span class="string">"charger"</span>,action_add_queue_tail);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		action_for_each_trigger(<span class="string">"late-init"</span>,action_add_queue_tail);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//触发器为属性是否设置</span></span><br><span class="line">	 queue_builtin_action(queue_property_triggers_action, <span class="string">"queue_property_triggers"</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!waiting_for_exec)&#123;</span><br><span class="line">			execute_one_command();</span><br><span class="line">			restart_processes();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> timeout=<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">if</span>(process_needs_restart)&#123;</span><br><span class="line">			timeout=(process_needs_restart-gettime())*<span class="number">1000</span>;</span><br><span class="line">			<span class="keyword">if</span>(timeout&lt;<span class="number">0</span>)</span><br><span class="line">				timeout=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!action_queue_empty()|| cur_action)&#123;</span><br><span class="line">			timeout=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		epoll_event ev;</span><br><span class="line">		<span class="comment">//循环 等待事件发生</span></span><br><span class="line">		<span class="keyword">int</span> nr =TEMP_FAILURE_RETRY(epoll_wait(epoll_fd,&amp;ev,<span class="number">1</span>,timeout));</span><br><span class="line">		<span class="keyword">if</span>(nr==<span class="number">-1</span>)&#123;</span><br><span class="line">			ERROR(<span class="string">"epoll_wait failed:%s\n"</span>,strerror(errno));</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(nr==<span class="number">1</span>)&#123;</span><br><span class="line">			((<span class="keyword">void</span> (*)())ev.data.ptr)();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-2-log系统"><a href="#1-2-log系统" class="headerlink" title="1.2 log系统"></a>1.2 log系统</h2><p>此时android的log系统还没有启动，采用kernel的log系统，打开设备节点<code>/dev/kmsg</code>，那么可通过<code>cat /dev/kmsg</code>来获取内核Log.</p>
<p>设置log的输出级别为<code>KLOG_NOTICE_LEVEL(5)</code>，当log级别小于5时则会输出到kernel log， 默认值为3.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#define KLOG_ERROR_LEVEL 3</span><br><span class="line">#define KLOG_WARNING_LEVEL 4</span><br><span class="line">#define KLOG_NOTICE_LEVEL 5</span><br><span class="line">#define KLOG_INFO_LEVEL 6</span><br><span class="line">#define KLOG_DEBUG_LEVEL 7</span><br><span class="line">#define KLOG_DEFAULT_LEVEL 3 //默认为3</span><br></pre></td></tr></table></figure>
<h2 id="1-3-console-init-action"><a href="#1-3-console-init-action" class="headerlink" title="1.3 console_init_action"></a>1.3 console_init_action</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">//init.cpp</span><br><span class="line">static int console_init_action(int nargs,char** args)&#123;</span><br><span class="line">	char console[PROP_VALUE_MAX];</span><br><span class="line">	if(property_get(&quot;ro.boot.console&quot;,console)&gt;0)&#123;</span><br><span class="line">		snprintf(console_name,sizeof(console_name),&quot;/dev/%s&quot;,console);</span><br><span class="line">	&#125;</span><br><span class="line">int fd = open(console_name, O_RDWR | O_CLOEXEC);</span><br><span class="line">    if (fd &gt;= 0)</span><br><span class="line">        have_console = 1;</span><br><span class="line">    close(fd);</span><br><span class="line"></span><br><span class="line">    fd = open(&quot;/dev/tty0&quot;, O_WRONLY | O_CLOEXEC);</span><br><span class="line">    if (fd &gt;= 0) &#123;</span><br><span class="line">        const char *msg;</span><br><span class="line">            msg = &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;  // console is 40 cols x 30 lines</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot;\n&quot;</span><br><span class="line">        &quot; A N D R O I D &quot;;</span><br><span class="line">        write(fd, msg, strlen(msg));</span><br><span class="line">        close(fd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这便是开机显示的底部带ANDROID字样的画面。</p>
<h2 id="1-4-restart-processes"><a href="#1-4-restart-processes" class="headerlink" title="1.4 restart_processes"></a>1.4 restart_processes</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//init.cpp</span><br><span class="line">static void restart_processes()&#123;</span><br><span class="line">	process_need_restart=0;</span><br><span class="line">	service_for_each_flags(SVC_RESTARTING,restart_service_if_needed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>检查service_list中的所有服务，对于带有<code>SVC_RESTARTING</code>标志的服务，则都会调用其相应的<code>restart_service_if_needed</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类型内核链表</span></span><br><span class="line">void service_for_each_flags(unsigned matchFlags,void(*func)(struct service *svc))&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">listnode</span>*<span class="title">node</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">service</span>*<span class="title">svc</span>;</span></span><br><span class="line">	list_for_each(node,&amp;serivce_list)&#123;</span><br><span class="line">		svc=node_to_item(node,struct service,slist);</span><br><span class="line">		<span class="keyword">if</span>(svc-&gt;flags&amp;matchflags)</span><br><span class="line">			func(svc);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">restart_service_if_needed</span><span class="params">(struct service*svc)</span></span>&#123;</span><br><span class="line">	<span class="keyword">time_t</span> next_start_time =svc-&gt;time_started+<span class="number">5</span>;</span><br><span class="line">	<span class="keyword">if</span>(next_start_time&lt;=gettime())&#123;</span><br><span class="line">		svc-&gt;flags&amp;=(~SVC_RESTARTING);</span><br><span class="line">		service_start(svc,<span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">if</span> ((next_start_time &lt; 	process_needs_restart) ||</span><br><span class="line">    	(process_needs_restart == <span class="number">0</span>)) &#123;</span><br><span class="line">    	process_needs_restart = next_start_time;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2-信号处理"><a href="#2-信号处理" class="headerlink" title="2.信号处理"></a>2.信号处理</h1><p>通过<code>signal_handler_init()</code>来初始化信号处理过程.主要工作：</p>
<ul>
<li>1.初始化signal句柄</li>
<li>2.循环处理子进程</li>
<li>3.注册epoll句柄</li>
<li>4.处理子进程终止</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">void signal_handler_init()&#123;</span><br><span class="line">	int s[2];</span><br><span class="line">	//创建socketpar</span><br><span class="line">	socketpair(AF_UNIX,SOCK_STREAM|SOCK_NONBLOCK|SOCK_CLOEXEC,0,s);</span><br><span class="line">	signal_write_fd=s[0];</span><br><span class="line">	sinal_read_fd=s[1];</span><br><span class="line">	//当捕获信息SIGCHLD,则写入signal_write_fd</span><br><span class="line">	struct sigaciton act;</span><br><span class="line">	act.sa_handler=SIGCHLD_handler;</span><br><span class="line">	//SA_NOCLDSTOP使init进程只有在其子进程终止时收到SIGCHLD信号</span><br><span class="line">	act.sa_flags=SA_NOCLDSTOP;	</span><br><span class="line">	sigaction(SIGCHLD,&amp;act,0);</span><br><span class="line">	reap_any_outstanding_children();</span><br><span class="line">	register_epoll_handler(signal_read_fd,handle_signal);</span><br><span class="line">&#125;</span><br><span class="line">static void SIGCHLD_handler(int)&#123;</span><br><span class="line">	//向signal_write_fd写入1，知道成功为止</span><br><span class="line">	if(TEMP_FAILURE_RETRY(signal_write_fd,&quot;1&quot;,1)==-1)&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//读取数据</span><br><span class="line">static void handle_signal()&#123;</span><br><span class="line">	char buf[32];</span><br><span class="line">	//读取signal_read_fd数据，放入buf</span><br><span class="line">	read(signal_read_fd,buf,sizeof(buf));</span><br><span class="line">	reap_any_outstanding_children();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每个进程在处理其他进程发送的signal信号时都需要先注册，当进程的运行状态改变或终止时会产生某种signal信号，<code>init进程</code>是所有用户空间进程的父进程，当其子进程终止时产生<code>SIGCHLD信号</code>，init进程调用信号安装函数<code>sigaction()</code>，传递参数给sigaction结构体，便完成信号处理的过程。</p>
<h2 id="2-1-reap-any-outstanding-children"><a href="#2-1-reap-any-outstanding-children" class="headerlink" title="2.1 reap_any_outstanding_children"></a>2.1 reap_any_outstanding_children</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//signal_handler.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reap_any_outstanding_children</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(wait_for_one_process())&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> boolean <span class="title">wait_for_one_process</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> status;</span><br><span class="line">	<span class="comment">//任意子进程，如果子进程没有退出则返回0，否则返回子进程pid</span></span><br><span class="line">	<span class="keyword">pid_t</span> pid=TEMP_FAILURE_RETRY(waitpid(<span class="number">-1</span>,&amp;status,WNOHANG));</span><br><span class="line">	<span class="keyword">if</span>(pid==<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(pid==<span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	serice* svc=servce_find_by_pid(pid);<span class="comment">//根据pid找到service</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> name;</span><br><span class="line">	<span class="keyword">if</span>(!svc)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="comment">//当flag为RESTART不是ONESHORT,先kill进程组内所有子进程或子线程</span></span><br><span class="line">	<span class="keyword">if</span>(!(svc-&gt;flags&amp; SVC_ONESHOT)||(svc-&gt;flags &amp; SVC_RESTART))&#123;</span><br><span class="line">		kill(-pid,SIGKILL);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//移除当前服务svc中所有创建的socket</span></span><br><span class="line">	<span class="keyword">for</span>(socketinfo*si=svc-&gt;sockets;si;si=si-&gt;next)&#123;</span><br><span class="line">		<span class="keyword">char</span> tmp[<span class="number">128</span>];</span><br><span class="line">		<span class="built_in">snprintf</span>(tmp,<span class="keyword">sizeof</span>(tmp),ANDROID_SOCKET_DI<span class="string">R"/%s"</span>,si-&gt;name);</span><br><span class="line">		unlink(tmp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//当flags为EXEC时，释放相应的服务</span></span><br><span class="line">	<span class="keyword">if</span>(svc-&gt;flags &amp; SVC_EXEC)&#123;</span><br><span class="line">		waiting_for_exec=<span class="literal">false</span>;</span><br><span class="line">		list_remove(&amp;svc-&gt;slist);</span><br><span class="line">		<span class="built_in">free</span>(svc-&gt;name);</span><br><span class="line">		<span class="built_in">free</span>(svc-&gt;);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	svc-&gt;pid=<span class="number">0</span>;</span><br><span class="line">	svc-&gt;flag&amp;=(~SVC_RUNNING);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//对于ONESHOT服务，使其进入disable状态</span></span><br><span class="line">	<span class="keyword">if</span>((svc-&gt;flags&amp;SVC_ONESHOT)&amp;&amp;!(svc-&gt;flags&amp;SVC-&gt;RESTART))&#123;</span><br><span class="line">		svc-&gt;flags|=SVC_DISABLED;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//禁用和重置服务，都不再自动重启</span></span><br><span class="line">	<span class="keyword">if</span>(svc-&gt;flag&amp; (SVC_DISABLE | SVC_RESET))&#123;</span><br><span class="line">		<span class="comment">//设置相应的service状态为stopped</span></span><br><span class="line">		svc-&gt;NotifyStateChange(<span class="string">"stopped"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//服务4分钟内启动次数超过4次，则重启手机进入recovery模式</span></span><br><span class="line">	<span class="keyword">time_t</span> now=gettime();</span><br><span class="line">	<span class="keyword">if</span>((svc-&gt;flags&amp;SVC_CRITICAL)&amp;&amp;!(svc-&gt;flags&amp;SVC_RESTART))&#123;</span><br><span class="line">		<span class="keyword">if</span>(svc-&gt;time_crashed+CRITICAL_CRASH_WINDOW&gt;=now)&#123;</span><br><span class="line">			<span class="keyword">if</span>(++svc-&gt;nr_crahsed&gt;CRITICAL_CRASH_THRESHOLD)&#123;</span><br><span class="line">				android_reboot(ANDROID_RB_RESTART2,<span class="number">0</span>,<span class="string">"recovery"</span>);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			svc-&gt;time_crashed=now;</span><br><span class="line">			svc-&gt;nr_crashed=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//执行当前service中所有onrestart命令</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">listnode</span>*<span class="title">node</span>;</span></span><br><span class="line">	list_for_each(node,&amp;svc-&gt;onrestart,commands)&#123;</span><br><span class="line">		command* cmd=node_to_item(node,struct command,clist);</span><br><span class="line">		cmd-&gt;func(cmd-&gt;nargs,cmd-&gt;args);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//设置相应的service状态为restarting</span></span><br><span class="line">	svc-&gt;NotifyStateChange(<span class="string">"restarting"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外：通过<code>getprop | grep init.svc</code>可查看所有的service运行状态。状态总共分为：<code>running</code>, <code>stopped</code>, <code>restarting</code></p>
<h2 id="2-2-register-epoll-handler"><a href="#2-2-register-epoll-handler" class="headerlink" title="2.2 register_epoll_handler"></a>2.2 register_epoll_handler</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//signal_handler.cpp</span></span><br><span class="line">void register_epoll_handler(int fd,void (*fn)())&#123;</span><br><span class="line">	epoll_event ev;</span><br><span class="line">	ev.events=EPOLLIN;</span><br><span class="line">	ev.data.ptr=reinterrupt_cast&lt;<span class="keyword">void</span>*&gt;(fn);</span><br><span class="line">	<span class="comment">//将fd可读事件加入到epoll_fd监听队列中</span></span><br><span class="line">	<span class="keyword">if</span>(epoll_fd(epoll_fd,EPOLL_CTL_ADD,fd,&amp;ev)==<span class="number">-1</span>)&#123;</span><br><span class="line">		ERROR(<span class="string">"epoll_ctl failed %s\n"</span>,strerror(errno));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-服务重启"><a href="#2-3-服务重启" class="headerlink" title="2.3 服务重启"></a>2.3 服务重启</h2><p><img src="/2016/09/30/init进程/init_oneshot.jpg" alt="服务重启流程"></p>
<p>当init子进程退出时，会产生SIGCHLD信号，并发送给init进程，通过socket套接字传递数据，调用到<code>wait_for_one_process()</code>方法，根据是否是<code>oneshot</code>，来决定是重启子进程，还是放弃启动。<br>所有的Service里面只有<code>servicemanager</code> ，<code>zygote</code> ，<code>surfaceflinger</code>这3个服务有onrestart关键字来触发其他service启动过程。</p>
<ul>
<li><code>zygote</code>：触发<code>media</code>、<code>netd</code>以及子进程(包括system_server进程)重启；</li>
<li><code>system_server</code>: 触发<code>zygote</code>重启;</li>
<li><code>surfaceflinger</code>：触发zygote重启;</li>
<li><code>servicemanager</code>: 触发<code>zygote</code>、<code>healthd</code>、<code>media</code>、<code>surfaceflinger</code>、<code>drm</code>重启</li>
</ul>
<p>所以<code>surfaceflinger</code>,<code>servicemanager</code>,<code>zygote</code>自身以及<code>system_server</code>进程被杀都会触发Zygote重启。</p>
<h1 id="3-rc文件语法"><a href="#3-rc文件语法" class="headerlink" title="3. rc文件语法"></a>3. rc文件语法</h1><p>rc文件语法是以<strong>行为单位</strong>，以<strong>空格间隔</strong>的语法，以<code>#</code>开始代表注释行。rc文件主要包含<code>Action</code>、<code>Service</code>、<code>Command</code>、<code>Options</code>，其中对于<code>Action</code>和<code>Service</code>的名称都是唯一的，<strong>对于重复的命名视为无效</strong>。</p>
<h2 id="3-1-Action"><a href="#3-1-Action" class="headerlink" title="3.1 Action"></a>3.1 Action</h2><p>Action： 通过<code>trigger</code>，即以<code>on</code>开头的语句，决定何时执行相应的service。<code>action_for_each_trigger(&quot;early-boot&quot;, action_add_queue_tail);</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">on property:vold.decrypt=trigger_reset_main</span><br><span class="line">    class_reset main</span><br></pre></td></tr></table></figure>
<ul>
<li><code>on early-init</code>:在初始化早期阶段触发；</li>
<li><code>on init</code>:在初始化阶段触发；</li>
<li><code>on late-init</code>:在初始化晚期阶段触发；</li>
<li><code>on boot/charger</code>： 当系统启动/充电时触发，还包含其他情况，此处不一一列举；</li>
<li><code>on property:&lt;key&gt;=&lt;value&gt;</code>: 当属性值满足条件时触发；</li>
</ul>
<h2 id="3-2-Service"><a href="#3-2-Service" class="headerlink" title="3.2 Service"></a>3.2 Service</h2><p>服务Service，以<code>service</code>开头，由init进程启动，一般运行于另外一个<code>init的子进程</code>，所以启动service前<strong>需要判断对应的可执行文件是否存在</strong>。init生成的子进程，定义在rc文件，其中每一个service，在启动时会通过<code>fork方式</code>生成子进程。</p>
<p>例如： <code>service servicemanager /system/bin/servicemanager</code>代表的是服务名为<code>servicemanager</code>，服务的路径，也就是服务执行操作时运行<code>/system/bin/servicemanager</code>。</p>
<h2 id="3-3-Command"><a href="#3-3-Command" class="headerlink" title="3.3 Command"></a>3.3 Command</h2><ul>
<li><code>class_start &lt;service_class_name&gt;</code>： 启动属于同一个class的所有服务；</li>
<li><code>start &lt;service_name&gt;</code>： 启动指定的服务，若已启动则跳过；</li>
<li><code>stop &lt;service_name&gt;</code>： 停止正在运行的服务</li>
<li><code>setprop &lt;name&gt; &lt;value&gt;</code>：设置属性值</li>
<li><code>mkdir &lt;path&gt;</code>：创建指定目录</li>
<li><code>symlink &lt;target&gt; &lt;sym_link&gt;</code>： 创建连接到<code>&lt;target&gt;</code>的<code>&lt;sym_link&gt;</code>符号链接；</li>
<li><code>write &lt;path&gt; &lt;string&gt;</code>： 向文件path中写入字符串；</li>
<li><code>exec</code>： fork并执行，会阻塞init进程直到程序完毕；</li>
<li><code>exprot &lt;name&gt; &lt;name&gt;</code>：设定环境变量；</li>
<li><code>loglevel &lt;level&gt;</code>：设置log级别</li>
</ul>
<h2 id="3-4Options"><a href="#3-4Options" class="headerlink" title="3.4Options"></a>3.4Options</h2><p><code>Options</code>是<code>Services</code>的可选项，与service配合使用</p>
<ul>
<li><code>disabled</code>: 不随class自动启动，只有根据service名才启动；</li>
<li><code>oneshot</code>: service退出后不再重启；</li>
<li><code>user/group</code>： 设置执行服务的<code>用户/用户组</code>，默认都是<code>root</code>；</li>
<li><code>class</code>：设置所属的类名，当所属类启动/退出时，服务也<code>启动/停止</code>，默认为default；</li>
<li><code>onrestart</code>:当服务重启时执行相应命令；</li>
<li><code>socket</code>: 创建名为<code>/dev/socket/&lt;name&gt;</code>的socket</li>
<li><code>critical</code>: 在规定时间内该service不断重启，则系统会重启并进入恢复模式</li>
</ul>
<p><strong>default</strong>: 意味着<code>disabled=false</code>，<code>oneshot=false</code>，<code>critical=false</code>。</p>

      
    </div>

    
    <div>
        
            <div>
    
        <br>
        <div style="text-align:center;color:#200000;font-size:30px;">-------------End-Thanks-------------</div>
    
</div>


        
    </div>

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android进程/" rel="tag"><i class="fa fa-tag"></i> Android进程</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/01/LinuxIO复用/" rel="next" title="LinuxIO复用">
                <i class="fa fa-chevron-left"></i> LinuxIO复用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/23/dumpsys/" rel="prev" title="dumpsys">
                dumpsys <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Melvin">
            
              <p class="site-author-name" itemprop="name">Melvin</p>
              <p class="site-description motion-element" itemprop="description">Learn Android/Linux OS</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/babymelvin" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:hang.yasuo@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://my.csdn.net/" target="_blank" title="CSDN"><i class="fa fa-fw fa-globe"></i>CSDN</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-概述"><span class="nav-text">1.概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-main"><span class="nav-text">1.1 main</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-log系统"><span class="nav-text">1.2 log系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-console-init-action"><span class="nav-text">1.3 console_init_action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-restart-processes"><span class="nav-text">1.4 restart_processes</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-信号处理"><span class="nav-text">2.信号处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-reap-any-outstanding-children"><span class="nav-text">2.1 reap_any_outstanding_children</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-register-epoll-handler"><span class="nav-text">2.2 register_epoll_handler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-服务重启"><span class="nav-text">2.3 服务重启</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-rc文件语法"><span class="nav-text">3. rc文件语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Action"><span class="nav-text">3.1 Action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-Service"><span class="nav-text">3.2 Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-Command"><span class="nav-text">3.3 Command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4Options"><span class="nav-text">3.4Options</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" style="background:#F8F8F8">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DO WAHTEVER YOU WANT TO DO!</span>

  

  
</div>











        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
